<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- JS file -->
  <script src="jquery.easy-autocomplete.min.js"></script>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

  <!-- CSS file -->
  <link rel="stylesheet" href="easy-autocomplete.min.css">

  <!-- Additional CSS Themes file - not required-->
  <link rel="stylesheet" href="easy-autocomplete.themes.min.css">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <style>
    .table td {
      padding-top: 2rem;
      padding-bottom: 2rem;
      font-size: 30px;
      border-top: none;
      font-family: 'Lato', sans-serif;
    }
  </style>
  <title>Live Bus Tracker</title>

  <!-- Bootstrap -->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="#">UIUC Bus Tracker</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="BusTracking.html?id=PLAZA&name=Transit%20Plaza">Transit Plaza <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="BusTracking.html?id=PAR&name=Pennsylvania%20Ave.%20Residence%20Hall">PAR</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="BusTracking.html?id=KRANNERT&name=Krannert%20Center">Krannert Center</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="BusTracking.html?id=1STSTDM&name=First%20and%20Stadium">First & Stadium</a>
        </li>
      </ul>
    </div>
  </nav>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <!--<form class="navbar-form" role="search">
    <div class="input-group add-on">
      <input class="form-control" placeholder="Search" name="srch-term" id="srch-term" type="text">
      <div class="input-group-btn">
        <button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>
      </div>
    </div>
  </form>-->
  <!-- Image and text -->
  <div class='container' style='margin-top:80px;'>
    <center>
      <h1>Welcome!</h1></br>
      <h4>Enter your location:</h4>
      <form>
        <input id='provider-remote'>
      </form>
      <h4>Or</h4>
      <button type="button" onclick="getLocation()" class="btn btn-primary">Get Nearest Stop</button>
    </center>
  </div>

  <div class="modal fade" id='myModal'>
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Where would you like to go?</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <div class="modal-body" id="modalBody">
          <p>Modal body text goes here.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="ModalRedirect()">Save changes</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>


  </div>
</body>
<script>
  var cumtd_api = "";
  var options = {
    url: function(phrase) {
      return "https://www.cumtd.com/autocomplete/stops/v1.0/json/search?query=" + phrase + "&format=json";
    },

    getValue: "n",

    list: {

      onChooseEvent: function() {
        var id = $("#provider-remote").getSelectedItemData().i;
        var name = $("#provider-remote").getSelectedItemData().n;
        window.location = `BusTracking.html?id=${id}&name=${name}`
      }
    }
  };

  $("#provider-remote").easyAutocomplete(options);

  function showModalBefore() {
    $('#myModal').modal('show');
    document.getElementById("modalBody").innerHTML = "Loading stops...";
  }

  function getLocation() {
    if (navigator.geolocation) {
      showModalBefore();
      navigator.geolocation.getCurrentPosition(showPosition);
    } else {
      window.alert("We could not get your location.");
    }
  }

  function showPosition(position) {
    $.getJSON(`http://developer.cumtd.com/api/v2.2/json/getstopsbylatlon?key=${cumtd_api}&pt=60&lat=${position.coords.latitude}&lon=${position.coords.longitude}`, function(data) {
      console.log(data);

      modalBody = document.getElementById("modalBody");
      modalBody.innerHTML = "";
      for (i = 0; i < 3; i++) {
        redirectURL = `BusTracking.html?id=${data.stops[i].stop_id}&name=${encodeURIComponent(data.stops[i].stop_name)}`;
        modalBody.innerHTML += `<a href=${redirectURL}>${data.stops[i].stop_name} (${(data.stops[i].distance*0.00018939).toFixed(2)} mi.)</a></br>`
        modalBody.innerHTML += ``;
        console.log(data.stops[i]);
      }




    });
  }
</script>

</html>
