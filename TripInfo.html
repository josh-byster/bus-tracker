<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- JS file -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/easy-autocomplete/1.3.5/jquery.easy-autocomplete.min.js"></script>

  <script type='text/javascript' src='api-keys.js'></script>


  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

  <!-- CSS file -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/easy-autocomplete/1.3.5/easy-autocomplete.min.css">

  <!-- Additional CSS Themes file - not required-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/easy-autocomplete/1.3.5/easy-autocomplete.themes.css">

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <style>
    .itinerary {
      background-color: #2ecc71;
    }
  </style>
  <title>Vehicle Route Information</title>

  <!-- Bootstrap -->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <
    script src = "https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js" >
  </script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109186351-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-109186351-1');
  </script>
</head>

<body>
  <!-- Include all compiled plugins (below), or include individual files as needed -->

  <div class='container' style='margin-top:80px;'>


    <div class="container">
      <h2 id='title'>Route for Vehicle</h2>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Stop Number</th>
            <th>Name</th>
            <th>Scheduled Depart Time</th>
          </tr>
        </thead>
        <tbody id='contents'>
        </tbody>
      </table>
    </div>

  </div>


  <script>
    function tConvert(time) {
      // Check correct time format and split into components
      var hours = Number(time.match(/^(\d+)/)[1]);
      var minutes = Number(time.match(/:(\d+)/)[1]);

      if (hours == 12 || hours == 24)
        hours = "12"
      else
        hours = hours % 12;
      if (minutes < 10) {
        minutes = "0" + minutes;
      }
      return `${hours}:${minutes}`;
    }
    var google_api = my_api_keys.GOOGLE_API_KEY;
    var cumtd_api = my_api_keys.CUMTD_API_KEY;
    var vars = {};
    var stop_lat = 0;
    var stop_long = 0;
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
      vars[key] = value;
    });
    $.getJSON(`http://developer.cumtd.com/api/v2.2/json/getstoptimesbytrip?key=${cumtd_api}&trip_id=` +
      vars["trip_id"], displayData);

    function displayData(data) {
      if (data) {
        console.log(data);
        for (i in data.stop_times) {
          stop = data.stop_times[i];
          document.getElementById('contents').innerHTML += `<tr><td>${parseInt(stop.stop_sequence)+1}</td><td>${stop.stop_point.stop_name}</td><td>${tConvert(stop.departure_time)}</td></tr>`
          console.log(`<tr><td>${parseInt(stop.stop_sequence)+1}</td><td>${stop.stop_point.stop_name}</td><td>${stop.arrival_time}</td></tr>`)
        }
      }
    }
  </script>
  <script type="text/javascript">
    window._urq = window._urq || [];
    _urq.push(['initSite', '96cc2c62-7395-4573-8001-5b852e8d380b']);
    (function() {
      var ur = document.createElement('script');
      ur.type = 'text/javascript';
      ur.async = true;
      ur.src = ('https:' == document.location.protocol ? 'https://cdn.userreport.com/userreport.js' : 'http://cdn.userreport.com/userreport.js');
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ur, s);
    })();
  </script>
</body>

</html>
